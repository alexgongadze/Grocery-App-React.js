<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<!-- REACT LIBRARY -->
	<script src="https://unpkg.com/react@15.5.4/dist/react.js"></script>
	<!-- REACT DOM LIBRARY -->
	<script src="https://unpkg.com/react-dom@15.5.4/dist/react-dom.js"></script>
	<!-- BABEL LIBRARY -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.25.0/babel.min.js"></script>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Open Sans -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">
	<!-- Main Styles -->
	<link rel="stylesheet" href="style.css">
	<title>Grocery App</title>
</head>
<body>

	<div id="app">React has not rendered yet</div>
	
	<script type="text/babel">

		let listArr = [ /* no ajax */
			{id: 1, name: "bread"},
			{id: 2, name: "bacon"},
			{id: 3, name: "cheese"},
			{id: 4, name: "tomato"},
			{id: 5, name: "onion"},
			{id: 6, name: "cucumber"},
			{id: 7, name: "mushrooms"},
			{id: 8, name: "sauce"}
		]


		class Container extends React.Component {			
			constructor() {
				super();
				this.state = { filterStatus: false };
			}
			render() {
				return(
					<div className="groc-container">
						<Header/>
						<Main filterPass={this.state.filterStatus}/> {/* !!!!! invoke filter method instead/with changing state*/}
						<Footer filterInit={this.onFilter.bind(this)}/>
					</div>
				);
			}
			onFilter(filterStatus) { this.setState({filterStatus}) }
		}

			const Header = () => <header className="groc-header">header</header>;

			class Footer extends React.Component {
			
				// constructor() {
				// 	super();
				// 	this.state = { isFiltered: false };
				// }

				filterItems() {
					this.props.filterInit(true);
				}

				unFilterItems() {
					this.props.filterInit(false);
				}

				render() {
					return (
						<footer className="groc-footer">
							<i className="fa fa-list groc-footer__icon" aria-hidden="true" onClick={this.unFilterItems.bind(this)}></i>
							footer
							<i className="fa fa-shopping-cart groc-footer__icon" aria-hidden="true" onClick={this.filterItems.bind(this)}></i>
						</footer>
					);
				}
			}

			class Main extends React.Component {
			
				constructor() {
					super();
					this.state = { listState: listArr };
				}
				
				_getItems() {
					return this.state.listState.map(item => <Item key={item.id} id={item.id} name={item.name} needStatus={this._needChange.bind(this)}/>);
				}
				
				render() {
					
					const items = this._getItems();

					// let items = listArr.map(item => <Item key={item.id} id={item.id} name={item.name} needStatus={this._needChange.bind(this)}/>)

					return(
						<main className="groc-main">
							<div className="groc-main__status">{'filtered: ' + this.props.filterPass.toString()}</div>
							<ul className="groc-list">
								{items}
							</ul>
						</main>
					);
				}

				// listArr = this._needChange();

				// _needChange() {
				_needChange(atHomeID) {
					let items = listArr;
					let idArr = [];
					if (this.props.filterPass) {
						items = listArr.filter(item => (item.id) !== atHomeID)
						// items = listArr.filter(item => item.id % 2 === 0)
						console.log('_needChange()', items);
					}

					this.setState({ listState: items });
				}
			}

				class Item extends React.Component {
			
					constructor(props) {
						super(props);
						this.state = {
							atHome: false,
							id: -1
						};
					}

					toggleState() {
						this.setState({
							atHome: !this.state.atHome
						});
						let itemID = -2;
						if (!this.state.atHome) {
							itemID = this.props.id;
						}
						this.setState({
							id: itemID
						});
						this.props.needStatus(itemID);
					}

					addToCart() {
						alert(`${this.props.name} is needed`);
					}

					goHome() {
						alert(`${this.props.name} is at home`);
					}
				
					render() {
					
						let className = "";

						if (this.state.atHome) {
							className = " at-home";
						}

						return(
							<li className={"groc-list__item" + className}>
								<i className="fa fa-shopping-cart groc-list__item__icon" aria-hidden="true" onClick={this.addToCart.bind(this)}></i>
								<i className="fa fa-home groc-list__item__icon" aria-hidden="true" onClick={this.goHome.bind(this)}></i>
								<span>
									<i className="fa fa-angle-left" aria-hidden="true" onClick={this.toggleState.bind(this)}></i>
									{this.props.name}
									<i className="fa fa-angle-right" aria-hidden="true" onClick={this.toggleState.bind(this)}></i>
								</span>
							</li>
						);
					}

				}

		ReactDOM.render(
			<Container/>,
			document.getElementById("app")
		);

	</script>
</body>
</html>